<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="与一群有趣的人，做一些有趣的事."><title>Redis简单介绍 | Matt's Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis简单介绍</h1><a id="logo" href="/.">Matt's Blog</a><p class="description">王蒙</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Redis简单介绍</h1><div class="post-meta">Jun 6, 2016<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><span> | </span><span class="post-count">5,259</span><span> 字</span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Times</span></span></div><a data-disqus-identifier="2016/06/06/redis-introduce/" href="/2016/06/06/redis-introduce/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis简介"><span class="toc-number">1.</span> <span class="toc-text">Redis简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是Redis"><span class="toc-number">1.1.</span> <span class="toc-text">什么是Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis的优点"><span class="toc-number">1.2.</span> <span class="toc-text">Redis的优点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis安装"><span class="toc-number">2.</span> <span class="toc-text">Redis安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis启动"><span class="toc-number">3.</span> <span class="toc-text">Redis启动</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#启动与配置"><span class="toc-number">3.1.</span> <span class="toc-text">启动与配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-PATH"><span class="toc-number">3.2.</span> <span class="toc-text">配置$PATH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看Redis"><span class="toc-number">3.3.</span> <span class="toc-text">查看Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动Redis-client"><span class="toc-number">3.4.</span> <span class="toc-text">启动Redis-client</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis数据类型"><span class="toc-number">4.</span> <span class="toc-text">Redis数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-strings"><span class="toc-number">4.1.</span> <span class="toc-text">Redis strings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-Lists"><span class="toc-number">4.2.</span> <span class="toc-text">Redis Lists</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-Hashes"><span class="toc-number">4.3.</span> <span class="toc-text">Redis Hashes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-无序集合"><span class="toc-number">4.4.</span> <span class="toc-text">Redis 无序集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis有序集合"><span class="toc-number">4.5.</span> <span class="toc-text">Redis有序集合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis系统管理"><span class="toc-number">5.</span> <span class="toc-text">Redis系统管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#适合全体类型的常用命令"><span class="toc-number">5.1.</span> <span class="toc-text">适合全体类型的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EXISTS-and-DEL"><span class="toc-number">5.1.1.</span> <span class="toc-text">EXISTS and DEL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TYPE-and-KEYS"><span class="toc-number">5.1.2.</span> <span class="toc-text">TYPE and KEYS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RANDOMKEY-and-CLEAR"><span class="toc-number">5.1.3.</span> <span class="toc-text">RANDOMKEY and CLEAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RENAME-and-RENAMENX"><span class="toc-number">5.1.4.</span> <span class="toc-text">RENAME and RENAMENX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DBSIZE"><span class="toc-number">5.1.5.</span> <span class="toc-text">DBSIZE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-时间相关命令"><span class="toc-number">5.2.</span> <span class="toc-text">Redis 时间相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#限定key生存时间"><span class="toc-number">5.2.1.</span> <span class="toc-text">限定key生存时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询key剩余生存时间"><span class="toc-number">5.2.2.</span> <span class="toc-text">查询key剩余生存时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#清除key"><span class="toc-number">5.2.3.</span> <span class="toc-text">清除key</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis设置相关命令"><span class="toc-number">5.3.</span> <span class="toc-text">Redis设置相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CONFIG-GET-and-CONFIG-SET"><span class="toc-number">5.3.1.</span> <span class="toc-text">CONFIG GET and CONFIG SET</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重置报告"><span class="toc-number">5.3.2.</span> <span class="toc-text">重置报告</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询信息"><span class="toc-number">5.4.</span> <span class="toc-text">查询信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis的高级应用"><span class="toc-number">6.</span> <span class="toc-text">Redis的高级应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安全性"><span class="toc-number">6.1.</span> <span class="toc-text">安全性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置密码"><span class="toc-number">6.1.1.</span> <span class="toc-text">设置密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重启redis-server-与redis-cli"><span class="toc-number">6.1.2.</span> <span class="toc-text">重启redis-server 与redis-cli</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主从复制"><span class="toc-number">6.2.</span> <span class="toc-text">主从复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务处理"><span class="toc-number">6.3.</span> <span class="toc-text">事务处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#持久化机制"><span class="toc-number">6.4.</span> <span class="toc-text">持久化机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#虚拟内存的使用"><span class="toc-number">6.5.</span> <span class="toc-text">虚拟内存的使用</span></a></li></ol></li></ol></div></div><div class="post-content"><p>本文是根据我在<a href="https://www.shiyanlou.com/courses/106" target="_blank" rel="external">实验楼-Redis基础教程</a>中学习的总结，简单讲述了一下Redis的安装和使用。</p>
<h1 id="Redis简介"><a href="#Redis简介" class="headerlink" title="Redis简介"></a>Redis简介</h1><h2 id="什么是Redis"><a href="#什么是Redis" class="headerlink" title="什么是Redis"></a>什么是Redis</h2><p>REmote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。Redis提供了一些丰富的数据结构，包括 <code>lists</code>, <code>sets</code>, <code>ordered sets</code> 以及 <code>hashes</code> ，当然还有和<code>Memcached</code>一样的 strings结构。Redis当然还包括了对这些数据结构的丰富操作。</p>
<p>Redis常被称作是一款数据结构服务器（<code>data structure server</code>）。Redis的键值可以包括字符串（strings）类型，同时它还包括哈希（hashes）、列表（lists）、集合（sets）和 有序集合（sorted sets）等数据类型。 对于这些数据类型，你可以执行原子操作。例如：对字符串进行附加操作（<code>append</code>）；递增哈希中的值；向列表中增加元素；计算集合的交集、并集与差集等。</p>
<h2 id="Redis的优点"><a href="#Redis的优点" class="headerlink" title="Redis的优点"></a>Redis的优点</h2><ul>
<li>性能极高：Redis能支持超过 100K+ 每秒的读写频率。</li>
<li>丰富的数据类型：Redis支持二进制案例的 <code>Strings</code>, <code>Lists</code>, <code>Hashes</code>, <code>Sets</code> 及 <code>Ordered Sets</code> 数据类型操作。</li>
<li>原子：Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</li>
<li>丰富的特性：Redis还支持 <code>publish/subscribe</code>, 通知, key 过期等等特性。</li>
</ul>
<h1 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h1><p>在<a href="http://redis.io/" target="_blank" rel="external">Redis官网</a>中下载最新的稳定版，这里我选用的是<code>3.2.0</code>稳定版。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 解压按照包</span><br><span class="line">$ tar xvfz redis-3.2.0.tar.gz</span><br><span class="line"></span><br><span class="line"># 编译</span><br><span class="line">$ cd redis-3.2.0</span><br><span class="line">$ sudo make</span><br><span class="line">$ sudo make install</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">$ make test</span><br></pre></td></tr></table></figure>
<p>测试成功的结果如下图所示：</p>
<p><img src="/images/redis/test.png" alt="test"></p>
<h1 id="Redis启动"><a href="#Redis启动" class="headerlink" title="Redis启动"></a>Redis启动</h1><h2 id="启动与配置"><a href="#启动与配置" class="headerlink" title="启动与配置"></a>启动与配置</h2><p>在 Redis 安装完成后，注意一些重要的文件，可用 ls 命令查看。</p>
<ul>
<li>服务端的启动脚本：<code>src/redis-server</code>；</li>
<li>客户端的启动脚本：<code>src/redis-cls</code>；</li>
<li>默认配置文件：<code>redis.conf</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动redis服务器</span></span><br><span class="line">$ ./src/redis-server</span><br></pre></td></tr></table></figure>
<p>启动成功结果如下图：</p>
<p><img src="/images/redis/start.png" alt="start"></p>
<blockquote>
<p>说明： 从上图中，可以发现启动的端口为缺省的<strong>6379</strong>. 用户可以在启动的时候，指定具体的配置文件，并在其中指定启动的端口。</p>
</blockquote>
<h2 id="配置-PATH"><a href="#配置-PATH" class="headerlink" title="配置$PATH"></a>配置$PATH</h2><p>然后将可执行文件放置在$PATH环境目录下，便于以后使用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo　cp src/redis-server /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">$　sudo cp src/redis-cli /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>
<h2 id="查看Redis"><a href="#查看Redis" class="headerlink" title="查看Redis"></a>查看Redis</h2><p>再启动玩Redis服务器之后，可以通过以下命令来查看Redis运行情况：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep redis</span><br><span class="line"><span class="comment"># 通过启动命令检查Redis服务器状态</span></span><br><span class="line">$ netstat -nlt|grep 6379</span><br></pre></td></tr></table></figure>
<p><img src="/images/redis/state.png" alt="state"></p>
<h2 id="启动Redis-client"><a href="#启动Redis-client" class="headerlink" title="启动Redis-client"></a>启动Redis-client</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br></pre></td></tr></table></figure>
<h1 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h1><p>Redis不仅仅是简单的<code>key-value</code> 存储器，正如本文开头所述Redis同时也是一种<code>data structures server</code>。传统的<code>key-value</code>是指支持使用一个<code>key</code>字符串来索引<code>value</code>字符串的存储，而Redis中，<code>value</code>不仅仅支持字符串，还支持更多的复杂结构，包括列表，集合，哈希表等。</p>
<p>在本小节中，我们一一讲解：Redis keys是采用<strong>二进制安全</strong>（这里的二进制安全可以理解为：只关心二进制化的字符串，不关心具体格式，只会严格的按照二进制的数据存取，并不会按照某种具体格式去解析，杜绝了出乱码的问题），这就意味着你可以使用任何二进制序列作为重点，从像”foo”可以联系一个 JPEG 文件。空字符串也是一个有效的密钥。</p>
<h2 id="Redis-strings"><a href="#Redis-strings" class="headerlink" title="Redis strings"></a>Redis strings</h2><p>字符串是一种最基本的Redis值类型。Redis字符串是二进制安全的，这意味着一个Redis字符串能包含任意类型的数据，例如： 一张JPEG格式的图片或者一个序列化的Ruby对象。一个字符串类型的值最多能存储512M字节的内容。</p>
<p>这里启动<code>redis-cli</code>来看看Redis strings数据类型。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务器与客户端</span></span><br><span class="line">$ sudo service redis-server start</span><br><span class="line">$ redis-cli</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis客户端下</span></span><br><span class="line">&gt; <span class="built_in">set</span> mykey somevalue</span><br><span class="line">&gt; get mykey</span><br></pre></td></tr></table></figure>
<p>如上例所示，可以<code>SET</code>和<code>GET</code>命令来创建和检索strings。注意,<code>set</code>命令将取代现有的任何已经存在的key。</p>
<p><code>SET</code>命令还有一个提供附加参数的选项,我们能够让<code>SET</code>命令只有在没有相同key的情况下成功，反之亦然，可以让<code>SET</code>命令在有相同key值得情况下成功。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> mykey newval nx</span><br><span class="line">&gt; <span class="built_in">set</span> mykey newval xx</span><br></pre></td></tr></table></figure>
<p>即使string是Redis的基本类型，也可以对其进行一些有趣的操作，例如加法器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> counter 100</span><br><span class="line">&gt; incr counter</span><br><span class="line">&gt; incr counter</span><br><span class="line">&gt; incrby counter 50</span><br></pre></td></tr></table></figure>
<p><code>INCR</code>命令让the value 成为一个整数，运行一次<code>INCR</code>便+1。<code>INCRBY</code>命令便是一个加法运算。类似的命令如减法运算为： <code>DECR and DECRBY</code>。</p>
<p>Redis可以运用<code>MSET and MGET</code> 命令完成一次性的完成多个key-value的对应关系，使用<code>MGET</code>命令，Redis返回一个value数组。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; mset a 10 b 20 c 30</span><br><span class="line">&gt; mget a b c</span><br></pre></td></tr></table></figure>
<p>以上操作的结果如下图所示：</p>
<p><img src="/images/redis/strings.png" alt="string"></p>
<h2 id="Redis-Lists"><a href="#Redis-Lists" class="headerlink" title="Redis Lists"></a>Redis Lists</h2><p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素导列表的头部（左边）或者尾部（右边）。</p>
<ul>
<li><code>LPUSH</code> 命令插入一个新的元素导头部；</li>
<li><code>RPUSH</code>插入一个新元素导尾部.</li>
</ul>
<p>当一个这两个操作在一个空的Key上被执行的时候一个新的列表被创建。相似的，如果一个列表操作清空一个列表那么对应的key将被从key空间中删除。</p>
<p><code>PUSH</code>一类的命令的返回值为list的长度。一些类表操作和结果的例子：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist A</span><br><span class="line">&gt; rpush mylist B</span><br><span class="line">&gt; lpush mylist first</span><br><span class="line">&gt; lrange mylist 0 -1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<code>LRANGE</code> 利用了两个检索值，0表示list的开头第一个，-1表示list的倒数第一个，即最后一个。-2则便是list的倒数第二个，以此类推。</p>
</blockquote>
<p>这些命令都是可变的命令，也就是说你可以一次加入多个元素放入list。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist 1 2 3 4 5 <span class="string">"foo bar"</span></span><br><span class="line">&gt; lrange mylist 0 -1</span><br></pre></td></tr></table></figure>
<p>在Redis的命令操作中，还有一类重要的操作：<code>POP</code>，取出list元素。和<code>PUSH</code>操作类似，<code>POP</code>命令可以选择不同的方向取出元素.<code>POP</code>命令返回值为取出的元素。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; del mylist</span><br><span class="line">&gt; rpush mylist a b c</span><br><span class="line">&gt; rpop mylist</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">&gt; lpop mylist</span><br><span class="line">&gt; lrange mylist 0 -1</span><br></pre></td></tr></table></figure>
<p>以上操作的结果如下图所示：</p>
<p><img src="/images/redis/list.png" alt="list"></p>
<h2 id="Redis-Hashes"><a href="#Redis-Hashes" class="headerlink" title="Redis Hashes"></a>Redis Hashes</h2><p>Redis Hashes是字符串字段和字符串值之间的映射，因此他们是展现对象的完美数据类型。 (例如:一个有名，姓，年龄等等属性的用户)：一个带有一些字段的<code>hash</code>仅仅需要一块很小的空间存储，因此你可以存储数以百万计的对象在一个小的Redis实例中。 哈希主要用来表现对象，他们有能力存储很多对象，因此你可以将哈希用于许多其他的任务。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; hmset user:1000 username antirez birthyear 1977 verified 1</span><br><span class="line">&gt; hget user:1000 username</span><br><span class="line">&gt; hget user:1000 birthyear</span><br><span class="line">&gt; hgetall user:1000</span><br></pre></td></tr></table></figure>
<ul>
<li><code>HMSET</code>命令设置一个多域的hash表；</li>
<li><code>HGET</code>命令获取指定的单域；</li>
<li><code>HGETALL</code>命令获取指定key的所有信息；</li>
<li><code>HMGET</code>类似于<code>HGET</code>，只是返回一个value数组。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; hmget user:1000 username birthyear no-such-field</span><br></pre></td></tr></table></figure>
<p>同样可以根据需要对hash表的表项进行单独的操作，例如 <code>HINCRBY</code>， （原本birthyear 为1977，见上一图）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; hincrby user:1000 birthyear 10</span><br><span class="line">&gt; hincrby user:1000 birthyear 10</span><br></pre></td></tr></table></figure>
<p>以上操作的结果如下图所示：</p>
<p><img src="/images/redis/hash.png" alt="hash"></p>
<h2 id="Redis-无序集合"><a href="#Redis-无序集合" class="headerlink" title="Redis 无序集合"></a>Redis 无序集合</h2><p>Redis 集合（Set）是一个<strong>无序的字符串集合</strong>. 你可以以$O(1)$的时间复杂度 (无论集合中有多少元素时间复杂度都是常量）完成添加、删除，以及测试元素是否存在。 Redis 集合拥有令人满意的不允许包含相同成员的属性。多次添加相同的元素，最终在集合里只会有一个元素。 实际上说这些就是意味着在添加元素的时候无须检测元素是否存在。 一个Redis集合的非常有趣的事情是他支持一些服务端的命令从现有的集合出发去进行集合运算，因此你可以在非常短的时间内进行合并（<code>unions</code>）, 求交集（<code>intersections</code>），找出不同的元素（<code>differences of sets</code>）。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd myset 1 2 3</span><br><span class="line">&gt; smembers myset</span><br></pre></td></tr></table></figure>
<ul>
<li><code>SADD</code>命令产生一个无序集合，并返回集合的元素个数；</li>
<li><code>SMEMBER</code>用于查看集合；</li>
<li><code>SISMEMBER</code>用于查看集合是否存在，匹配项包括集合名和元素个数，匹配成功返回1，匹配失败返回0。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; sismember myset 3</span><br><span class="line">&gt; sismember myset 30</span><br><span class="line">&gt; sismember mys 3</span><br></pre></td></tr></table></figure>
<p>以上操作的结果如下图所示：</p>
<p><img src="/images/redis/set1.png" alt="set1"></p>
<h2 id="Redis有序集合"><a href="#Redis有序集合" class="headerlink" title="Redis有序集合"></a>Redis有序集合</h2><p>Redis有序集合与普通集合非常相似，是一个<strong>没有重复元素的字符串集合</strong>。不同之处是有序集合的没有成员都关联了一个<strong>评分</strong>，这个评分被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以是重复了。 使用有序集合你可以以非常快的速度（$O\log{N}$）添加，删除和更新元素。因为元素是有序的, 所以你也可以很快的根据评分（<code>score</code>）或者次序（<code>position</code>）来获取一个范围的元素。访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。在有序集合中，你可以很快捷的访问一切你需要的东西：有序的元素，快速的存在性测试，快速访问集合的中间元素！ 简而言之使用有序集合你可以做完成许多对性能有极端要求的任务，而那些任务使用其他类型的数据库真的是很难完成的。</p>
<p><code>ZADD</code>与<code>SADD</code>类似，但是在元素之前多了一个参数，这个参数便是用于排序的。形成一个有序的集合。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd hackers 1940 <span class="string">"Alan Kay"</span></span><br><span class="line">&gt; zadd hackers 1957 <span class="string">"Sophie Wilson"</span></span><br><span class="line">&gt; zadd hackers 1953 <span class="string">"Richard Stallman"</span></span><br><span class="line">&gt; zadd hackers 1949 <span class="string">"Anita Borg"</span></span><br><span class="line">&gt; zadd hackers 1965 <span class="string">"Yukihiro Matsumoto"</span></span><br><span class="line">&gt; zadd hackers 1914 <span class="string">"Hedy Lamarr"</span></span><br><span class="line">&gt; zadd hackers 1916 <span class="string">"Claude Shannon"</span></span><br><span class="line">&gt; zadd hackers 1969 <span class="string">"Linus Torvalds"</span></span><br><span class="line">&gt; zadd hackers 1912 <span class="string">"Alan Turing"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>ZRANGE</code>是查看正序的集合;</li>
<li><code>ZREVRANGE</code>是查看反序的集合。0表示集合第一个元素，-1表示集合的倒数第一个元素。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1</span><br><span class="line">&gt; zrevrange hackers 0 -1</span><br></pre></td></tr></table></figure>
<p>使用<code>WITHSCORES</code> 参数返回记录值。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1 withscores</span><br></pre></td></tr></table></figure>
<p>以上操作的结果如下图所示：</p>
<p><img src="/images/redis/set2.png" alt="set2"></p>
<h1 id="Redis系统管理"><a href="#Redis系统管理" class="headerlink" title="Redis系统管理"></a>Redis系统管理</h1><p>在Redis中，命令大小写不敏感。</p>
<h2 id="适合全体类型的常用命令"><a href="#适合全体类型的常用命令" class="headerlink" title="适合全体类型的常用命令"></a>适合全体类型的常用命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务器与客户端</span></span><br><span class="line">$ redis-server</span><br><span class="line">$ redis-cli</span><br></pre></td></tr></table></figure>
<h3 id="EXISTS-and-DEL"><a href="#EXISTS-and-DEL" class="headerlink" title="EXISTS and DEL"></a>EXISTS and DEL</h3><ul>
<li><code>EXISTS key</code> 判断一个key是否存在，存在返回 1;否则返回0;</li>
<li><code>DEL key</code> 删除某个key，或是一系列key，<code>DEL key1 key2 key3 key4</code>。成功返回1，失败返回0（key值不存在）。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> mykey hello</span><br><span class="line">&gt; exists mykey</span><br><span class="line"></span><br><span class="line">&gt; del mykey</span><br><span class="line">&gt; exists mykey</span><br></pre></td></tr></table></figure>
<p><img src="/images/redis/exist.png" alt="exist"></p>
<h3 id="TYPE-and-KEYS"><a href="#TYPE-and-KEYS" class="headerlink" title="TYPE and KEYS"></a>TYPE and KEYS</h3><ul>
<li><code>TYPE key</code>：返回某个key元素的数据类型 ( none:不存在,string:字符,list,set,zset,hash)，key不存在返回空。</li>
<li><code>KEYS key—pattern</code> ：返回匹配的key列表 (<code>KEYS foo*</code>:查找foo开头的keys)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> mykey x</span><br><span class="line">&gt; <span class="built_in">type</span> mykey</span><br><span class="line">&gt; keys my*</span><br><span class="line">&gt; del mykey</span><br><span class="line">&gt; keys my*</span><br><span class="line">&gt; <span class="built_in">type</span> mykey</span><br></pre></td></tr></table></figure>
<p><img src="/images/redis/type.png" alt="type"></p>
<h3 id="RANDOMKEY-and-CLEAR"><a href="#RANDOMKEY-and-CLEAR" class="headerlink" title="RANDOMKEY and CLEAR"></a>RANDOMKEY and CLEAR</h3><ul>
<li><code>RANDOMKEY</code> ： 随机获得一个已经存在的key，如果当前数据库为空，则返回空字符串</li>
<li><code>CLEAR</code> ：清除界面。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; randomkey</span><br><span class="line">&gt; clear</span><br></pre></td></tr></table></figure>
<h3 id="RENAME-and-RENAMENX"><a href="#RENAME-and-RENAMENX" class="headerlink" title="RENAME and RENAMENX"></a>RENAME and RENAMENX</h3><ul>
<li><code>RENAME oldname newname</code>：改key的名字，新键如果存在将被覆盖;</li>
<li><code>RENAMENX oldname newname</code>：更改key的名字，如果名字存在则更改失败.</li>
</ul>
<p>笔者randomkey结果为mylist，将此key值更名为newlist。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; randomkey</span><br><span class="line">&gt; rename mylist newlist</span><br><span class="line">&gt; exists mylist</span><br><span class="line">&gt; exists newlist</span><br></pre></td></tr></table></figure>
<p><img src="/images/redis/rename.png" alt="rename"></p>
<h3 id="DBSIZE"><a href="#DBSIZE" class="headerlink" title="DBSIZE"></a>DBSIZE</h3><p><code>DBSIZE</code> ：返回当前数据库的key的总数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; dbsize</span><br></pre></td></tr></table></figure>
<h2 id="Redis-时间相关命令"><a href="#Redis-时间相关命令" class="headerlink" title="Redis 时间相关命令"></a>Redis 时间相关命令</h2><h3 id="限定key生存时间"><a href="#限定key生存时间" class="headerlink" title="限定key生存时间"></a>限定key生存时间</h3><p>这同样是一个无视数据类型的命令，对于临时存储很有用处。避免进行大量的DEL操作。</p>
<ul>
<li><code>EXPIRE</code>：设置某个key的过期时间（秒）,(<code>EXPIRE bruce 1000</code>：设置<code>bruce</code>这个key1000秒后系统自动删除)</li>
</ul>
<blockquote>
<p>注意：如果在还没有过期的时候，对值进行了改变，那么那个值会被清除。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> key some-value</span><br><span class="line">&gt; expire key 10</span><br><span class="line"><span class="comment"># 马上执行此命令</span></span><br><span class="line">&gt; get key</span><br><span class="line"><span class="comment"># 10s后执行此命令</span></span><br><span class="line">&gt; get key</span><br></pre></td></tr></table></figure>
<p>结果显示，执行EXPIRE命令后，马上GET，显示key存在。10秒后再GET时，key 已经被自动删除。</p>
<p><img src="/images/redis/ttl.png" alt="ttl"></p>
<h3 id="查询key剩余生存时间"><a href="#查询key剩余生存时间" class="headerlink" title="查询key剩余生存时间"></a>查询key剩余生存时间</h3><p>限时操作可以再<code>SET</code>命令中实现，并且可用<code>TTL</code>命令查询key剩余生存时间。</p>
<p><code>TTL</code>：查找某个key还有多长时间过期,返回时间秒</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> key 100 ex 30</span><br><span class="line">&gt; ttl key</span><br><span class="line">&gt; ttl key</span><br></pre></td></tr></table></figure>
<h3 id="清除key"><a href="#清除key" class="headerlink" title="清除key"></a>清除key</h3><ul>
<li><code>FLUSHDB</code>：清空当前数据库中的所有键;</li>
<li><code>FLUSHALL</code>：清空所有数据库中的所有键.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; flushdb</span><br><span class="line">&gt; flushall</span><br></pre></td></tr></table></figure>
<h2 id="Redis设置相关命令"><a href="#Redis设置相关命令" class="headerlink" title="Redis设置相关命令"></a>Redis设置相关命令</h2><p>Redis有其配置文件，可以通过client-command窗口查看或者更改相关配置。相关命令介绍如下：</p>
<h3 id="CONFIG-GET-and-CONFIG-SET"><a href="#CONFIG-GET-and-CONFIG-SET" class="headerlink" title="CONFIG GET and CONFIG SET"></a>CONFIG GET and CONFIG SET</h3><ul>
<li><code>CONFIG GET</code>：用来读取运行Redis服务器的配置参数。</li>
<li><code>CONFIG SET</code>：用于更改运行Redis服务器的配置参数。</li>
<li><code>AUTH</code> : 认证密码，下面针对Redis密码的示例：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; config get requirepass （查看密码）</span><br><span class="line">&gt; config <span class="built_in">set</span> requirepass test123 （设置密码为test123 ）</span><br><span class="line">&gt; config get requirepass  （报错，没有认证）</span><br><span class="line">&gt; auth test123</span><br><span class="line">&gt; config get requirepass</span><br></pre></td></tr></table></figure>
<p>由结果可知，刚开始时Reids并未设置密码，密码查询结果为空。然后设置密码为test123，再次查询报错。经过auth命令认证后，可正常查询。</p>
<p>可以经过修改Redis的配置文件redis.conf修改密码。</p>
<p><code>CONFIG GET</code>命令是以list的key-value对显示的，如查询数据类型的最大条目：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; config get *max-*-entries*</span><br></pre></td></tr></table></figure>
<p><img src="/images/redis/pass.png" alt="pass"></p>
<h3 id="重置报告"><a href="#重置报告" class="headerlink" title="重置报告"></a>重置报告</h3><p><code>CONFIG RESETSTAT</code>：重置数据统计报告，通常返回值为’OK”。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; CONFIG RESETSTAT</span><br></pre></td></tr></table></figure>
<h2 id="查询信息"><a href="#查询信息" class="headerlink" title="查询信息"></a>查询信息</h2><p><code>INFO [section]</code> ：查询Redis相关信息。 INFO命令可以查询Redis几乎所有的信息，其命令选项有如下：</p>
<ul>
<li><code>server</code> : Redis server的常规信息</li>
<li><code>clients</code> : Client的连接选项</li>
<li><code>memory</code> : 存储占用相关信息</li>
<li><code>persistence</code> : RDB and AOF 相关信息</li>
<li><code>stats</code> : 常规统计</li>
<li><code>replication</code> : Master/slave请求信息</li>
<li><code>cpu</code> : CPU 占用信息统计</li>
<li><code>cluster</code> : Redis 集群信息</li>
<li><code>keyspace</code> : 数据库信息统计</li>
<li><code>all</code> : 返回所有信息</li>
<li><code>default</code> : 返回常规设置信息</li>
</ul>
<p>若命令参数为空，info命令返回所有信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; info keyspace</span><br><span class="line">&gt; info server</span><br></pre></td></tr></table></figure>
<h1 id="Redis的高级应用"><a href="#Redis的高级应用" class="headerlink" title="Redis的高级应用"></a>Redis的高级应用</h1><p>本节来讲述Redis的高级应用，包括：安全性设置，主从复制，事务处理， 持久化机制， 虚拟内存的使用。</p>
<h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2><p>设置在客户端连接是需要指定的密码（由于redis速度相当的快，一秒钟可以150K次的密码尝试，所以需要设置一个密码强度很大的密码）。</p>
<p>设置密码的方式有两种：</p>
<ol>
<li>使用<code>config set</code> 命令的<code>requirepass</code> 参数，具体格式为<code>config set requirepass “password”</code>;</li>
<li>配置<code>redis.conf</code> 中设置<code>requirepass</code>属性，后面为密码。</li>
</ol>
<p>输入认证的方式也有两种：</p>
<ol>
<li>登录时可以 <code>redis-cli -a password</code>;</li>
<li>登录后使用 <code>auth password</code>.</li>
</ol>
<h3 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h3><p>第一种密码设置方式在上面已经提到，（在<code>CONFIG SET</code>命令讲解的实例），此处我们来看看第二种方式设置密码。</p>
<p>首先需要进入Redis的安装目录，然后修改配置文件<code>redis.conf</code>。根据<code>grep</code>命令的结果，使用vi编辑器修改<code># requirepass foobared</code> 为<code>requirepass test123</code>，然后保存退出。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ grep -n requirepass /etc/redis/redis.conf</span><br><span class="line">$ sudo vim /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
<h3 id="重启redis-server-与redis-cli"><a href="#重启redis-server-与redis-cli" class="headerlink" title="重启redis-server 与redis-cli"></a>重启redis-server 与redis-cli</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启redis server。</span></span><br><span class="line">$ sudo service redis-server restart</span><br></pre></td></tr></table></figure>
<p>进入到redis-cli交互界面进行验证</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">&gt; info</span><br><span class="line">&gt; auth test123</span><br><span class="line">&gt; info</span><br><span class="line">&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<p>结果表明第一次<code>info</code>命令失败，在<code>auth</code>认证之后<code>info</code>命令正常返回。最后退出<code>redis-cli</code>。</p>
<p>另外一种密码认证方式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -a test123</span><br><span class="line">&gt; info</span><br></pre></td></tr></table></figure>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>Redis的主从复制配置和使用都比较简单，通过主从复制可以允许多个slave server拥有和master server相同的数据库副本。从服务器只能读，不能写。</p>
<p>Redis主从复制特点：</p>
<ol>
<li>master可以拥有多个slave;</li>
<li>多个slave可以连接同一个master外，还可以连接到其他的slave。（当master宕机后，相连的slave转变为master）;</li>
<li>主从复制不会阻塞master，再同步数据时，master可以继续处理client请求;</li>
<li>提高了系统的可伸缩性。</li>
</ol>
<p>Redis主从复制的过程：</p>
<ol>
<li>Slave与master建立连接，发送sync同步命令;</li>
<li>Master会启动一个后台进程，将数据库快照保存到文件中，同时Master主进程会开始收集新的写命令并缓存;</li>
<li>后台完成保存后，就将此文件发送给Slave;</li>
<li>Slave将此文件保存到磁盘上。</li>
</ol>
<h2 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h2><p>Redis的事务处理比较简单。只能保证client发起的事务中的命令可以连续的执行，而且不会插入其他的client命令，当一个client在连接中发出multi命令时，这个连接就进入一个事务的上下文，该连接后续的命令不会执行，而是存放到一个队列中，当执行exec命令时，redis会顺序的执行队列中的所有命令。如果其中执行出现错误，执行正确的不会回滚，不同于关系型数据库的事务。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; multi</span><br><span class="line">&gt; <span class="built_in">set</span> name a</span><br><span class="line">&gt; <span class="built_in">set</span> name b</span><br><span class="line">&gt; <span class="built_in">exec</span></span><br><span class="line">&gt; get name</span><br></pre></td></tr></table></figure>
<p><img src="/images/redis/multi.png" alt="multi"></p>
<h2 id="持久化机制"><a href="#持久化机制" class="headerlink" title="持久化机制"></a>持久化机制</h2><p>Redis是一个支持持久化的内存数据库，Redis需要经常将内存中的数据同步到磁盘来保证持久化。</p>
<p>Redis支持两种持久化方式：</p>
<ol>
<li><code>snapshotting</code>（快照），将数据存放到文件里，默认方式。<br>是将内存中的数据已快照的方式写入到二进制文件中，默认文件<code>dump.rdb</code>，可以通过配置设置自动做快照持久化的方式。可配置Redis在n秒内如果超过m个key被修改就自动保存快照。<ul>
<li><code>save 900 1</code>: 900秒内如果超过1个key被修改，则发起快照保存;</li>
<li><code>save 300 10</code>: 300秒内如果超过10个key被修改，则快照保存.</li>
</ul>
</li>
<li><code>Append-only file</code>（缩写为<code>aof</code>），将读写操作存放到文件中。</li>
</ol>
<blockquote>
<p>Note: 由于快照方式在一定间隔时间做一次，所以如果Redis意外down掉的话，就会丢失最后一次快照后的所有修改。</p>
</blockquote>
<p><code>aof</code>比快照方式有更好的持久化性，是由于使用<code>aof</code>时，redis会将每一个收到的写命令都通过write函数写入到文件中当redis启动时会通过重新执行文件中保存的写命令来在内存中重新建立整个数据库的内容。</p>
<p>由于os会在内核中缓存write做的修改，所以可能不是立即写到磁盘上，这样aof方式的持久化也还是有可能会丢失一部分数据。可以通过配置文件告诉redis我们想要通过<code>fsync</code>函数强制os写入到磁盘的时机。</p>
<p>配置文件中的可配置参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">appendonly   yes     //启用aof持久化方式</span><br><span class="line">#appendfsync  always //收到写命令就立即写入磁盘，最慢，但是保证了数据的完整持久化</span><br><span class="line">appendfsync   everysec  //每秒中写入磁盘一次，在性能和持久化方面做了很好的折中</span><br><span class="line">#appendfsync  no     //完全依赖os，性能最好，持久化没有保证</span><br></pre></td></tr></table></figure>
<p>在redis-cli的命令中，SAVE命令是将数据写入磁盘中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">help</span> save</span><br><span class="line">&gt; save</span><br></pre></td></tr></table></figure>
<h2 id="虚拟内存的使用"><a href="#虚拟内存的使用" class="headerlink" title="虚拟内存的使用"></a>虚拟内存的使用</h2><p>虚拟内存管理在2.6及之上版本取消了，本文安装的的是3.2.0版本的redis ，所以配置文件中并没有虚拟内存管理功能的配置选项。此处仅仅是大概介绍一下。</p>
<p>Redis的虚拟内存是暂时把不经常访问的数据从内存交换到磁盘中，从而腾出内存空间用于其他的访问数据，尤其对于redis这样的内存数据库，内存总是不够用的。除了分隔到多个redis server外，提高数据库的容量的方法就是使用虚拟内存，把那些不常访问的数据交换到磁盘上。</p>
<p>通过配置vm相关的<code>redis.config</code>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vm-enable  yes                   #开启vm功能</span><br><span class="line">vm-swap-file    /tmp/redis.swap  #交换出来的value保存的文件路径</span><br><span class="line">vm-max-memory    10000000        #redis使用的最大内存上线</span><br><span class="line">vm-page-size   32       #每个页面的大小32字节</span><br><span class="line">vm-pages     123217729    #最多使用多小个页面</span><br><span class="line">vm-max-threads     4        #用于执行value对象换入的工作线程数量</span><br></pre></td></tr></table></figure>
<hr>
<p>参考</p>
<ul>
<li><a href="http://redis.io/" target="_blank" rel="external">Redis官网</a></li>
<li><a href="http://www.redis.cn/" target="_blank" rel="external">Redis中文网站</a></li>
<li><a href="http://redisdoc.com/" target="_blank" rel="external">Redis命令参考</a></li>
<li><a href="http://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="external">Redis | 菜鸟教程</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://matt33.com/2016/06/06/redis-introduce/" data-id="ck1z3ydgh0060qpjhx4mnhfaj" class="article-share-link">分享到</a><div class="copyright"><a href="http://matt33.com/copyright/">博客版权说明</a></div><div class="tags"><a href="/tags/database/">database</a></div><div class="post-nav"><a href="/2016/07/09/mac-software/" class="pre">Mac常用软件及环境配置</a><a href="/2016/05/21/java-serializable/" class="next">Java序列化学习</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'http-matt33-com';
var disqus_identifier = '2016/06/06/redis-introduce/';
var disqus_title = 'Redis简单介绍';
var disqus_url = 'http://matt33.com/2016/06/06/redis-introduce/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//http-matt33-com.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-weibo"> 微博</i></div><iframe width="100%" height="90" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=100&fansRow=1&ptype=1&speed=0&skin=1&isTitle=0&noborder=1&isWeibo=0&isFans=0&uid=2650396571&verifier=f2f0e397&colors=D8D8D8,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/书屋/">书屋</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/影如人生/">影如人生</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/旅行/">旅行</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/storm/" style="font-size: 15px;">storm</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/learn/" style="font-size: 15px;">learn</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/cv/" style="font-size: 15px;">cv</a> <a href="/tags/paper/" style="font-size: 15px;">paper</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/travel/" style="font-size: 15px;">travel</a> <a href="/tags/database/" style="font-size: 15px;">database</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/tcp/" style="font-size: 15px;">tcp</a> <a href="/tags/电影随想/" style="font-size: 15px;">电影随想</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a> <a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/分布式系统/" style="font-size: 15px;">分布式系统</a> <a href="/tags/bk/" style="font-size: 15px;">bk</a> <a href="/tags/rpc/" style="font-size: 15px;">rpc</a> <a href="/tags/thrift/" style="font-size: 15px;">thrift</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/calcite/" style="font-size: 15px;">calcite</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/10/20/paper-flink-snapshot/">Paper 阅读: Lightweight Asynchronous Snapshots for Distributed Dataflow</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/19/paper-ray1/">Paper 阅读: Real-Time Machine Learning: The Missing Pieces</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/17/apache-calcite-planner/">Apache Calcite 优化器详解（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/07/apache-calcite-process-flow/">Apache Calcite 处理流程详解（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/28/bk-store-realize/">BookKeeper 原理浅谈</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/21/effective-learning/">如何高效学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/04/kafka-transaction/">Kafka Exactly-Once 之事务性实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/kafka-idempotent/">Kafka 事务性之幂等性实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/19/bk-cluster-install-and-use/">BookKeeper 集群搭建及使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/01/yarn-architecture-learn/">YARN 架构学习总结</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://matt33.com/about/" title="个人公众号：柳年思水" target="_blank">个人公众号：柳年思水</a><ul></ul><a href="http://tech.meituan.com/" title="美团点评技术团队" target="_blank">美团点评技术团队</a><ul></ul><a href="http://jm.taobao.org/" title="阿里中间件团队博客" target="_blank">阿里中间件团队博客</a><ul></ul><a href="http://www.jianshu.com/" title="简书" target="_blank">简书</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Matt's Blog 柳年思水.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><div class="analytics"><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1256517224'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1256517224%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></div><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-64518924-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?5cf44757fa0d23bc7637935e44a9104a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>